---
- name: Configure Debian host
  hosts: all
  remote_user: root
  become: true

  tasks:
    - name: Install packages
      ansible.builtin.apt:
        name:
          - sudo
          - gpg
          - ufw
          - vim
          - mc
          - btop
          - git
          - curl
          - wget
          - powertop
          - smartmontools
          - bash-completion
          - fastfetch
        state: present
        update_cache: true

    - name: Download Tailscale GPG key
      ansible.builtin.get_url:
        url: https://pkgs.tailscale.com/stable/debian/trixie.noarmor.gpg
        dest: /usr/share/keyrings/tailscale-archive-keyring.gpg
        mode: '0644'
      become: true

    - name: Tailscale repository
      ansible.builtin.apt_repository:
        repo: >
          deb https://pkgs.tailscale.com/stable/debian
          {{ ansible_distribution_release }} main
        state: present
        filename: tailscale
        update_cache: true

    - name: Install Tailscale
      ansible.builtin.apt:
        name: tailscale
        state: present
        update_cache: true
